@model WorkOrder

@{
    ActionBarHelper.AddMapLink();
    ActionBarHelper.HideEditButton = true;
}
@Html.ScriptFor("~/Scripts/Areas/FieldOperations/WorkOrder/AssetTabs.js", ScriptLoadType.LoadFromPartial)

@* NOTE: This needs to exist *outside of the tabs* otherwise this error will get missed
    due to the tab-remembering feature. *@
@if (Model.HasRealSAPError)
{
    @Html.DisplayInlineNotification(new MMSINC.Models.ViewModels.NotificationItem {
        Message = Model.SAPErrorCode,
        NotificationType = MMSINC.Models.ViewModels.NotificationItemType.Error
    })
}

@if (Model.SpecialInstructions != null)
{
    <h5>
        @Html.DisplayLabelFor(x => x.SpecialInstructions):
        <span style="color: red" id="WorkOrderSpecialInstructions">@Html.DisplayTextFor(m => m.SpecialInstructions)</span>
    </h5>
}
@(Html
    .Tabs()
    .WithTab("Initial Information",
        "~/Areas/FieldOperations/Views/WorkOrder/_InitialDetails.cshtml",
        Model)
    .WithTab("Valve", "~/Areas/FieldOperations/Views/WorkOrder/_Valve.cshtml", 
        Model.Valve, isVisible: Model.AssetType.Id == AssetType.Indices.VALVE)
    .WithTab("Hydrant", "~/Areas/FieldOperations/Views/WorkOrder/_Hydrant.cshtml",
        Model.Hydrant, isVisible: Model.AssetType.Id == AssetType.Indices.HYDRANT)
    .WithTab("Sewer Opening", "~/Areas/FieldOperations/Views/WorkOrder/_SewerOpening.cshtml",
        Model.SewerOpening, isVisible: Model.AssetType.Id == AssetType.Indices.SEWER_OPENING)
    .WithTab(
        "Markouts",
        "~/Areas/FieldOperations/Views/Markout/_Index.cshtml",
        Model,
        isVisible: Model.MarkoutRequired || Model.Markouts.Any(),
        itemCount: Model.Markouts.Count)
    .WithTab(
        "Traffic Control/Notes",
        "_TrafficControl",
        Model,
        itemCount: Model.TrafficControlTickets.Count)
    .WithTab(
        "Street Opening Permits",
        "~/Areas/FieldOperations/Views/StreetOpeningPermit/_Index.cshtml",
        Model,
        isVisible: Model.StreetOpeningPermitRequired || Model.StreetOpeningPermits.Any(),
        itemCount: Model.StreetOpeningPermits.Count)
    .WithTab(
        "Crew Assignments",
        "~/Areas/FieldOperations/Views/WorkOrder/_CrewAssignments.cshtml",
        Model,
        itemCount: Model.CrewAssignments.Count)
    .WithDocuments())

@if (Html.CurrentUserCanEdit())
{
	@Html.LinkButton("Edit", "Edit", "GeneralWorkOrder", new { area = "FieldOperations", id = Model.Id }, new { id = "btnEdit" })
}